<!DOCTYPE html>
<html data-theme="dracula" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}DailyPwn &ndash; {{ page_title }} {% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
</head>
<body class="font-Roboto h-full">
    <!-- Sistema de Notificaciones -->
    <div class="notification-container" id="notificationContainer">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} shadow-lg mb-2 notification" id="notification-{{ loop.index }}">
                <div class="flex items-center justify-between">
                    <span>{{ message }}</span>
                    <button class="btn btn-xs btn-circle btn-ghost" onclick="closeNotification('notification-{{ loop.index }}')">✕</button>
                </div>
            </div>
            {% endfor %}
        {% endwith %}
    </div>
    
    <!-- This is the header for the cellphone -->
    <div class="navbar shadow-sm z-10000 flex items-center justify-between lg:hidden">
        <div class="flex items-center space-x-3 navbar-start">
          <!-- Menu Button -->
          <div class="dropdown">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
              <svg class="fill-current" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5 7h14M5 12h14M5 17h14"/>
              </svg>
            </div>
      
            <!-- Dropdown Content -->
            <ul tabindex="0" class="menu dropdown-content p-2 z-[1] bg-base-100 shadow rounded-box w-56">
              {% for link in main_menu_links %}
              <a href="{{ link.href }}" class="flex items-center space-x-2 hover:text-accent py-2">
                {{ link.svg | safe }}
                <span>{{ link.text.upper() }}</span>
              </a>
              {% endfor %}
      
              {% if current_user.is_authenticated %}
              <li>
                <a href="" class="flex items-center space-x-2 hover:text-accent">
                    <svg class="w-6 fill-current" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd" d="M12 20a7.966 7.966 0 0 1-5.002-1.756l.002.001v-.683c0-1.794 1.492-3.25 3.333-3.25h3.334c1.84 0 3.333 1.456 3.333 3.25v.683A7.966 7.966 0 0 1 12 20ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10c0 5.5-4.44 9.963-9.932 10h-.138C6.438 21.962 2 17.5 2 12Zm10-5c-1.84 0-3.333 1.455-3.333 3.25S10.159 13.5 12 13.5c1.84 0 3.333-1.455 3.333-3.25S13.841 7 12 7Z" clip-rule="evenodd"/>
                    </svg>
                    <span>{{current_user.username.upper()}}</span>
                </a>
                <span id="streak-status-mobile" href="" class="flex items-center space-x-2 {% if current_user.has_done_streak_today %}text-accent{% endif %}">
                    <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8.597 3.2A1 1 0 0 0 7.04 4.289a3.49 3.49 0 0 1 .057 1.795 3.448 3.448 0 0 1-.84 1.575.999.999 0 0 0-.077.094c-.596.817-3.96 5.6-.941 10.762l.03.049a7.73 7.73 0 0 0 2.917 2.602 7.617 7.617 0 0 0 3.772.829 8.06 8.06 0 0 0 3.986-.975 8.185 8.185 0 0 0 3.04-2.864c1.301-2.2 1.184-4.556.588-6.441-.583-1.848-1.68-3.414-2.607-4.102a1 1 0 0 0-1.594.757c-.067 1.431-.363 2.551-.794 3.431-.222-2.407-1.127-4.196-2.224-5.524-1.147-1.39-2.564-2.3-3.323-2.788a8.487 8.487 0 0 1-.432-.287Z"/>
                    </svg>
                    <span>{{current_user.current_streak}}</span>
                </span>
                <span>
                    <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13.09 3.294c1.924.95 3.422 1.69 5.472.692a1 1 0 0 1 1.438.9v9.54a1 1 0 0 1-.562.9c-2.981 1.45-5.382.24-7.25-.701a38.739 38.739 0 0 0-.622-.31c-1.033-.497-1.887-.812-2.756-.77-.76.036-1.672.357-2.81 1.396V21a1 1 0 1 1-2 0V4.971a1 1 0 0 1 .297-.71c1.522-1.506 2.967-2.185 4.417-2.255 1.407-.068 2.653.453 3.72.967.225.108.443.216.655.32Z"/>
                    </svg>
                    <span>{{current_user.total_points}}</span>
                </span>
                <form id="logout-form" action="{{ url_for('auth_frontend.logout') }}" method="POST" style="display: none;"></form>
                <a href="#" onclick="document.getElementById('logout-form').submit();" class="flex items-center space-x-2 hover:text-accent py-2">
                  <!-- logout SVG -->
                  <svg class="w-6 fill-current" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H8m12 0-4 4m4-4-4-4M9 4H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h2"/>
                    </svg>
                  <span>{{ 'Cerrar Sesión'.upper() }}</span>
                </a>
            </li>
              {% else %}
              {% for link in auth_links %}
              <a href="{{ link.href }}" class="flex items-center space-x-2 hover:text-accent py-2">
                {{ link.svg | safe }}
              <span>{{ link.text.upper() }}</span>
              </a>
              {% endfor %}
              {% endif %}
            </ul>
          </div>
      
          <!-- Site Name -->
          <a href="/" class="text-4xl font-bold font-RobotoMono text-accent space-x-3">
            {{ "DailyPwn".upper() }}
          </a>
        </div>
      </div>
      

      <!-- This is the pc banner-->
    <div class="navbar flex flex-col items-start space-y-4 hidden lg:block">
        <div>
            <a href="/" class="text-4xl font-bold font-RobotoMono text-accent">{{ "DailyPwn".upper() }}</a>
        </div>
        <div class="flex justify-between w-full">
            <ul class="flex flex-row space-x-4">
                {% for link in main_menu_links %}
                <a href="{{ link.href }}" class="flex items-center space-x-2 hover:text-accent">
                    {{ link.svg | safe }}
                    <span>{{ link.text.upper() }}</span>
                </a>
                {% endfor %}
            </ul>
            <ul class="flex flex-row space-x-4">
                {% if current_user.is_authenticated %}
                    <a href="" class="flex items-center space-x-2 hover:text-accent">
                        <svg class="w-6 fill-current" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path fill-rule="evenodd" d="M12 20a7.966 7.966 0 0 1-5.002-1.756l.002.001v-.683c0-1.794 1.492-3.25 3.333-3.25h3.334c1.84 0 3.333 1.456 3.333 3.25v.683A7.966 7.966 0 0 1 12 20ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10c0 5.5-4.44 9.963-9.932 10h-.138C6.438 21.962 2 17.5 2 12Zm10-5c-1.84 0-3.333 1.455-3.333 3.25S10.159 13.5 12 13.5c1.84 0 3.333-1.455 3.333-3.25S13.841 7 12 7Z" clip-rule="evenodd"/>
                        </svg>
                        <span>{{current_user.username.upper()}}</span>
                    </a>
                <span id="streak-status-desktop" href="" class="flex items-center space-x-2 {% if current_user.has_done_streak_today %}text-accent{% endif %}">
                    <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8.597 3.2A1 1 0 0 0 7.04 4.289a3.49 3.49 0 0 1 .057 1.795 3.448 3.448 0 0 1-.84 1.575.999.999 0 0 0-.077.094c-.596.817-3.96 5.6-.941 10.762l.03.049a7.73 7.73 0 0 0 2.917 2.602 7.617 7.617 0 0 0 3.772.829 8.06 8.06 0 0 0 3.986-.975 8.185 8.185 0 0 0 3.04-2.864c1.301-2.2 1.184-4.556.588-6.441-.583-1.848-1.68-3.414-2.607-4.102a1 1 0 0 0-1.594.757c-.067 1.431-.363 2.551-.794 3.431-.222-2.407-1.127-4.196-2.224-5.524-1.147-1.39-2.564-2.3-3.323-2.788a8.487 8.487 0 0 1-.432-.287Z"/>
                    </svg>
                    <span>{{current_user.current_streak}}</span>
                </span>
                <span class="flex items-center space-x-2">
                    <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13.09 3.294c1.924.95 3.422 1.69 5.472.692a1 1 0 0 1 1.438.9v9.54a1 1 0 0 1-.562.9c-2.981 1.45-5.382.24-7.25-.701a38.739 38.739 0 0 0-.622-.31c-1.033-.497-1.887-.812-2.756-.77-.76.036-1.672.357-2.81 1.396V21a1 1 0 1 1-2 0V4.971a1 1 0 0 1 .297-.71c1.522-1.506 2.967-2.185 4.417-2.255 1.407-.068 2.653.453 3.72.967.225.108.443.216.655.32Z"/>
                    </svg>
                    <span>{{current_user.total_points}}</span>
                </span>
                    <form id="logout-form" action="{{ url_for('auth_frontend.logout') }}" method="POST" style="display: none;"></form>
                    <a href="#" onclick="document.getElementById('logout-form').submit();" class="flex items-center space-x-2 hover:text-accent">
                        <svg class="w-6 fill-current" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H8m12 0-4 4m4-4-4-4M9 4H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h2"/>
                        </svg>
                        <span>{{ "Cerrar Sesión".upper() }}</span>
                    </a>
                {% else %}
                <ul class="flex flex-row space-x-4">
                {% for link in auth_links %}
                <a href="{{ link.href }}" class="flex items-center space-x-2 hover:text-accent">
                    {{ link.svg | safe }}
                    <span>{{ link.text.upper() }}</span>
                </a>
                {% endfor %}
                {% endif %}
            </ul>
        </div>
    </div>
    {% block content %}{% endblock %}
    <footer class="footer text-base-content p-10">
        <nav>
            <h6 class="footer-title">Cursos</h6>
            {% for link in [
                {'href': '/courses/programming', 'text': 'Programación'},
                {'href': '/courses/operating-systems', 'text': 'Sistemas Operativos'},
                {'href': '/courses/legislations', 'text': 'Legislaciones'},
                {'href': '/courses/personal-security', 'text': 'Seguridad Personal'},
                {'href': '/courses/osint', 'text': 'Inteligencia De Fuentes Abiertas (OSINT)'},
                {'href': '/courses/owasp-top-ten', 'text': 'OWASP Top 10'},
            ] %}
                <a href="{{ link.href }}" class="link link-hover hover:text-accent">{{ link.text }}</a>
            {% endfor %}
        </nav>
        </footer>
        <footer class="footer text-base-content border-base-300 border-t px-10 py-4 text-base py-6">
        <aside class="grid-flow-col items-center">
            <a href="/privacy-policy" class="hover:text-accent">Política de Privacidad</a>
        </aside>
        <nav class="lg:place-self-center lg:justify-self-end">
            <div class="grid grid-flow-col gap-4">
                &copy; 2025 DailyPwn
            </div>
        </nav>
    </footer>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Sistema de Notificaciones
        function initNotifications() {
            document.querySelectorAll('#notificationContainer .notification').forEach((notification, index) => {
                setTimeout(() => notification.classList.add('show'), 100 * index);
                setTimeout(() => closeNotification(notification.id), 5000);
            });
        }
        
        function closeNotification(id) {
            const notification = document.getElementById(id);
            if (notification) {
                notification.classList.add('hide');
                setTimeout(() => notification.remove(), 300);
            }
        }
        
        function showNotification(message, category = 'info') {
            const container = document.getElementById('notificationContainer');
            const notificationId = 'notification-' + Date.now();
            
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `alert alert-${category} shadow-lg mb-2 notification`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button class="btn btn-xs btn-circle btn-ghost" onclick="closeNotification('${notificationId}')">✕</button>
                </div>
            `;
            
            container.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => closeNotification(notificationId), 5000);
        }
        
        document.addEventListener('DOMContentLoaded', initNotifications);

        // WebSocket para streaks
        var socket = io("http://localhost:5000"); 
        socket.on('streak_update', function(data) {
            {% if current_user.is_authenticated %}
            var currentUserId = {{ current_user.id }};
            if (String(data.user_id).trim() === String(currentUserId).trim()) {
                const updateStreak = (element, count) => {
                    if (element) {
                        element.querySelector('span').textContent = count;
                        element.classList.toggle('text-accent', count > 0);
                    }
                };
                
                updateStreak(document.getElementById('streak-status-mobile'), data.new_streak);
                updateStreak(document.getElementById('streak-status-desktop'), data.new_streak);
                
                if (data.new_streak > 0) {
                    showNotification(`🔥 Streak: ${data.new_streak} días`, 'success');
                }
            }
            {% endif %}
        });
    </script>
</body>
</html>